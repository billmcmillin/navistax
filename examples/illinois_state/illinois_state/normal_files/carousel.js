(function(b){b.fn.carousel=function(h){var f={rate:2000,steps:30,decay:1.2,wrap:false,proportional:true,hidepartial:false};h=b.extend(f,h||{});function a(c){return(c&&c.length>0)?c[0]:null}function g(c){return window.getComputedStyle?window.getComputedStyle(c,null):c.currentStyle}return this.each(function(){var K=this;function G(k){if((k.data>=0&&!H.canMoveLeft)||(k.data<0&&!H.canMoveRight)){return}if(H.timer){clearTimeout(H.timer)}var j=k.data<0?Math.max(k.data,-1*(L.container+H.left-L.viewport)):Math.min(k.data,Math.abs(H.left));P(j+H.left);H.amount=j*Math.pow(h.decay,h.steps)/H.totalBias;H.count=h.steps;H.timer=setTimeout(I,h.rate/h.steps)}function Q(j){var n=b(j.currentTarget).closest(".item"),m,l=0,k=0,o=0;if(!n.length){return}for(m=0;m<J.items.length;m++){l+=L.items[m];if(J.items[m]===n[0]){k=L.items[m];break}}o=l-k;if(o>=Math.abs(H.left)&&l<=Math.abs(H.left)+L.viewport){return}if(o<Math.abs(H.left)){G({data:Math.abs(H.left)-o})}else{G({data:(Math.abs(H.left)+L.viewport)-l})}}function I(){H.left+=H.amount;H.amount/=h.decay;J.container.style.left=H.left+"px";F();H.count--;if(H.count===0){clearTimeout(H.timer);H.timer=null;return}H.timer=setTimeout(I,h.rate/h.steps)}function F(){if(!J.thumb){return}var j=Math.abs(H.left)/(L.container-L.viewport)*(L.track-L.thumb);H.thumb=j;J.thumb.style.left=j+"px"}function P(j){H.canMoveLeft=Math.floor(j)<0;H.canMoveRight=Math.abs(Math.ceil(j))+L.viewport<L.container;if(H.canMoveLeft){b(".moveButton.left",K).removeClass("disabled")}else{b(".moveButton.left",K).addClass("disabled")}if(H.canMoveRight){b(".moveButton.right",K).removeClass("disabled")}else{b(".moveButton.right",K).addClass("disabled")}}function i(){L={items:[],container:0,viewport:b(J.viewport).innerWidth(),track:J.track?b(J.track).innerWidth():0,thumb:b(J.thumb).outerWidth(true)};J.items.each(function(){var j=b(this).outerWidth(true);L.items.push(j);L.container+=j});if(h.proportional&&J.thumb){if(L.viewport>L.container){b(J.track,K).add(".moveButton",K).hide()}else{b(J.track,K).add(".moveButton",K).show();L.thumb=(L.viewport/L.container)*L.track;J.thumb.style.width=L.thumb+"px"}}if(h.hidepartial){d(L.items[0])}}function d(j){J.viewport.style.width="auto";var k=b(J.viewport).innerWidth();aShowElements=Math.floor(k/j);J.viewport.style.width=aShowElements*j+"px";b(".viewport").removeClass("loading")}function c(k){if(k.target===J.thumb||k.originalTarget===J.thumb){return}var j=k.layerX/L.track,m=j*(L.container-L.viewport),l=-1*(m+H.left);G({data:l})}function T(j){j.cancelBubble=true;D.active=true;D.start=j.clientX-H.thumb;if(H.timer){clearTimeout(H.timer);H.timer=null}b(document.body).bind("mousemove",null,N).bind("mouseup",null,M)}function N(l){if(!D.active){return}var j=l.clientX-D.start;if(j<0||j>L.track-L.thumb){return}var k=(j/(L.track-L.thumb))*(L.container-L.viewport);H.left=-1*k;J.container.style.left=H.left+"px";J.thumb.style.left=j+"px";H.thumb=j}function M(){D.active=false;b(document.body).unbind("mousemove",N).unbind("mouseup",M);P(H.left)}function C(j){if(j.keyCode===37){G({data:L.viewport})}else{if(j.keyCode===39){G({data:-1*L.viewport})}}}function R(){b(document.body).bind("keypress",null,C)}function e(){b(document.body).unbind("keypress",C)}function O(){i();var j=H.left+(L.container-L.viewport);if(j<0){G({data:-1*j})}else{F()}P(H.left)}var H={timer:null,left:0,amount:0,count:0,totalBias:0,thumb:0,canMoveLeft:false,canMoveRight:false},D={active:false,position:0,start:0},J={items:b(".item",this),viewport:a(b(".viewport",this)),container:document.createElement("div"),track:a(b(".track",this)),thumb:a(b(".thumb",this))},L,E;for(E=1;E<=h.steps;E++){H.totalBias+=Math.pow(h.decay,E)}if(J.items.length===0){return}i();J.container.style.width=L.container+"px";J.container.style.position="relative";J.container.style.left="0px";J.items.each(function(){J.container.appendChild(this)});J.viewport.appendChild(J.container);if(h.hidepartial){var S=b(J.viewport).innerWidth();b(".moveButton.left",this).bind("click",S,G);b(".moveButton.right",this).bind("click",-1*S,G)}else{b(".moveButton.left",this).bind("click",L.viewport,G);b(".moveButton.right",this).bind("click",-1*L.viewport,G)}b(".thumb",this).bind("click",c).bind("mousedown",T).bind("ondragstart",function(){return false}).bind("mouseup",M).bind("resize",O).bind("focus",R).bind("blur",e);b(".item *",this).bind("focus",Q);if(h.hidepartial){b(window,this).bind("resize",function(){d(b(J.items[0]).outerWidth(true))})}P(H.left)})}}(jQuery));